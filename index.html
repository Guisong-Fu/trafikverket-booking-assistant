<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>BankID Relay Demo</title>
</head>
<body>
    <h1>Scan Your BankID</h1>
    <img id="qrImage" src="" alt="QR code will appear here..." width="300">
    <p id="status"></p>

    <script>
    async function fetchQrAndUpdate() {
        try {
            const resp = await fetch("/qr");
            if (!resp.ok) {
                throw new Error("QR not ready");
            }
            const data = await resp.json();
            if (data.success) {
                // Update QR image
                const base64 = data.qr_image_base64;
                document.getElementById("qrImage").src = "data:image/png;base64," + base64;

                // Check auth status
                if (data.auth_complete) {
                    document.getElementById("status").innerText = "âœ… Logged in!";
                } else {
                    document.getElementById("status").innerText = "Please scan the code in BankID...";
                }
            }
        } catch (err) {
            console.log("Error fetching QR", err);
        }
    }

    // Poll every 2 seconds
    setInterval(fetchQrAndUpdate, 1000);
    </script>
</body>
</html>